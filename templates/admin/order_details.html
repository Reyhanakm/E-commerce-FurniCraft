{% extends "admin/base_admin.html" %}
{% block title %}Order {{ order.order_id }} - Details{% endblock %}

{% block content %}

<div class="mb-6">
    <h1 class="text-2xl font-semibold text-gray-800">
        Order Details – {{ order.order_id }}
    </h1>
</div>


<div class="bg-white shadow rounded-lg p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Order Information</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">

        <div>
            <p><span class="font-medium">Customer:</span> 
               {{ order.user.first_name }} {{ order.user.last_name }}</p>

            <p><span class="font-medium">Email:</span> {{ order.user.email }}</p>

            <p><span class="font-medium">Payment Method:</span> 
                {{ order.get_payment_method_display }}
            </p>

            <p><span class="font-medium">Payment Status:</span>
                {% if order.is_paid == "paid" %}
                    <span class="text-green-600 font-semibold">Paid</span>
                {% elif order.is_paid == "pending" %}
                    <span class="text-yellow-600 font-semibold">Pending</span>
                {% else %}
                    <span class="text-red-600 font-semibold">Failed</span>
                {% endif %}
            </p>
            <form method="POST">
            {% csrf_token %}
            <select name="payment_status" class="border rounded px-2 py-1">
                <option value="pending" {% if order.is_paid == "pending" %}selected{% endif %}>Pending</option>
                <option value="paid" {% if order.is_paid == "paid" %}selected{% endif %}>Paid</option>
                <option value="failed" {% if order.is_paid == "failed" %}selected{% endif %}>Failed</option>
            </select>

            <button class="bg-[#b82d2d] text-white px-3 py-1 rounded hover:bg-[#a22727] transition">Update</button>
            </form>


            <p><span class="font-medium">Order Date:</span> 
                {{ order.created_at|date:"d M Y, h:i A" }}
            </p>
        </div>

        <div>
            <p class="font-medium mb-1">Delivery Address:</p>
            <div class="p-3 border rounded-md bg-gray-50">
                <p>{{ order.address.name }}</p>
                <p>{{ order.address.phone }}</p>
                <p>{{ order.address.address_line_1 }}</p>
                <p>{{ order.address.city }}, {{ order.address.state }}</p>
                <p>{{ order.address.pincode }}</p>
            </div>

            <p class="mt-4">
                <span class="font-medium">Total Amount:</span>
                ₹{{ order.total_price }}
            </p>
        </div>

    </div>
</div>

<!-- ORDER ITEMS TABLE -->
<div class="bg-white shadow rounded-lg overflow-hidden">
    <h2 class="px-6 py-4 border-b font-semibold text-gray-700 text-lg">
        Items in Order
    </h2>

    <table class="min-w-full text-left">
        <thead class="bg-gray-100 text-gray-700">
            <tr>
                <th class="px-6 py-3">Product</th>
                <th class="px-6 py-3">Qty</th>
                <th class="px-6 py-3">Unit Price</th>
                <th class="px-6 py-3">Total</th>
                <th class="px-6 py-3">Status</th>
                <th class="px-6 py-3 text-center">Actions</th>
            </tr>
        </thead>

        <tbody class="text-gray-700">
            {% for item in items %}
            <tr class="border-b">
                <td class="px-6 py-4">
                    {{ item.product.product.name }} 
                    — ({{ item.product.variant_name }})
                </td>

                <td class="px-6 py-4">{{ item.quantity }}</td>
                <td class="px-6 py-4">₹{{ item.unit_price }}</td>
                <td class="px-6 py-4">₹{{ item.price }}</td>

                <td class="px-6 py-4">
                    <span class="font-medium ">
                        {{ item.get_status_display }}
                    </span>
                </td>

                <td class="px-6 py-4 text-center">

                    <!-- STATUS UPDATE FORM -->
                    <form method="POST" class="inline-flex gap-2">
                        {% csrf_token %}
                        <input type="hidden" name="item_id" value="{{ item.id }}">

                        <select 
                            name="status"
                            class="border rounded px-2 py-1"
                        >
                            {% for value,label in item.STATUS_CHOICES %}
                                <option value="{{ value }}"
                                    {% if value == item.status %}selected{% endif %}
                                >
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>

                        <button 
                            class="bg-[#b82d2d] text-white px-3 py-1 rounded hover:bg-[#a22727] transition">
                            Update
                        </button>
                    </form>

                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
