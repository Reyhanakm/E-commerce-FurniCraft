{% extends "admin/base_admin.html" %}
{% load custom_tags %}
{% block title %}Order List - FurniCraft Admin{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-semibold text-gray-800">Orders</h1>

  <!-- Search -->
  <div class="flex items-center gap-3">
    <form method="get" class="flex items-center gap-3">
      <div class="relative">
        <input 
          type="text" 
          name="q" 
          placeholder="Search by Order ID or User" 
          value="{{ search_query }}"
          class="pl-10 pr-4 py-2 border rounded-md focus:ring focus:ring-gray-200"
        />

        <!-- Search Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" 
             class="w-5 h-5 absolute left-3 top-2.5 text-gray-400"
             fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
        </svg>

        {% if search_query %}
          <a href="{% url 'order_list' %}"
             class="absolute right-3 top-2 text-gray-400 hover:text-red-500 font-bold">✕</a>
        {% endif %}
      </div>

      <button type="submit" class="bg-[#b82d2d] text-white px-4 py-2 rounded-md">Search</button>
    </form>
  </div>
</div>

<!-- Order Table -->
<div class="bg-white shadow-sm rounded-md overflow-hidden">
  <table class="min-w-full text-left border-collapse">
    <thead>
      <tr class="bg-[#b82d2d] text-white">
        <th class="px-4 py-2">#</th>
        <th class="px-4 py-2">Order ID</th>
        <th class="px-4 py-2">Customer</th>
        <th class="px-4 py-2">Total</th>
        <th class="px-4 py-2">Payment Status</th>
        <th class="px-4 py-2">Created At</th>
        <th class="px-4 py-2 text-center">Actions</th>
      </tr>
    </thead>

    <tbody class="text-gray-700">
      {% for order in page_obj %}
      <tr class="border-b hover:bg-gray-50">
        
        <!-- Auto Increment -->
        <td class="px-4 py-3">
          {{ forloop.counter0|add:page_obj.start_index }}
        </td>

        <!-- Order ID -->
        <td class="px-4 py-3 font-medium text-gray-900">
          {{ order.order_id }}
        </td>

        <!-- Customer -->
        <td class="px-4 py-3">
          {{ order.user.first_name }} {{ order.user.last_name }}
        </td>

        <!-- Total Price -->
        <td class="px-4 py-3">
          {% if order.total_price %}
              ₹{{ order.total_price }}
          {% else %}
              ₹{{ order.total_price_before_discount }}
          {% endif %}
        </td>

        <!-- Payment Status -->
        <td class="px-4 py-3">
          {% if order.payment_status == "paid" %}
            <span class="text-green-600 font-medium">Paid</span>
          {% elif order.payment_status == "pending" %}
            <span class="text-yellow-600 font-medium">Pending</span>
          {% elif order.payment_status == "refunded" %}
              <span class="text-blue-600 font-semibold">Refunded</span>
          {% elif order.payment_status == "partially_refunded" %}
              <span class="text-orange-600 font-semibold">Partially refunded</span>
          {% else %}
            <span class="text-red-600 font-medium">Failed</span>
          {% endif %}
        </td>

        <!-- Created At -->
        <td class="px-4 py-3">
          {{ order.created_at|date:"Y-m-d H:i" }}
        </td>

        <!-- Actions -->
        <td class="px-4 py-3 text-center">

          <a href="{% url 'order_details' order.order_id %}"
            class="text-blue-600 hover:text-blue-800 font-medium mr-2">
            View
          </a>

        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center py-6 text-gray-500">
          No orders found.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% include "pagination.html" %}
{% endblock %}
