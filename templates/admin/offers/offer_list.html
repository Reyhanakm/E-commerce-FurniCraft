{% extends "admin/base_admin.html" %}

{% block title %}Offers | FurniCraft Admin{% endblock %}

{% block content %}

<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-semibold text-[#8b7b5b]">Offer Management</h1>

  <div class="flex items-center gap-4">
    <!-- Search -->
    <form method="get" class="flex items-center gap-3">
      <div class="relative">
      <input type="text"
             name="q"
             placeholder="Search offers..."
             value="{{ search_query }}"
             class="pl-10 px-4 py-2 border rounded-md">

      <svg xmlns="http://www.w3.org/2000/svg" 
            class="w-5 h-5 absolute left-3 top-2.5 text-gray-400"
            fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
      </svg>

        {% if search_query %}
          <a href="{% url 'admin_offer_list' %}"
             class="absolute right-3 top-2 text-gray-400 hover:text-red-500 font-bold">✕</a>
        {% endif %}
      </div>
          

      <button class="bg-[#b82d2d] text-white px-4 py-2 rounded-md">
        Search
      </button>
    </form>

    <!-- Add buttons -->
    <a href="{% url 'admin_product_offer_create' %}"
       class="px-4 py-2 rounded-md bg-[#b82d2d] text-white">
      + Product Offer
    </a>

    <a href="{% url 'admin_category_offer_create' %}"
       class="px-4 py-2 rounded-md bg-[#8b7b5b] text-white">
      + Category Offer
    </a>
  </div>
</div>
<!--product offer section-->

<h2 class="text-lg font-semibold mb-3">Product Offers</h2>

<div class="bg-white border rounded-xl overflow-hidden mb-8">
  <table class="w-full text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-3 text-left">Name</th>
        <th class="px-4 py-3 text-left">Product</th>
        <th class="px-4 py-3 text-left">Discount</th>
        <th class="px-4 py-3 text-left">Validity</th>
        <th class="px-4 py-3 text-left">Status</th>
        <th class="px-4 py-3 text-left">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y">
      {% for offer in product_offers %}
      <tr>
        <td class="px-4 py-3 font-medium">{{ offer.name }}</td>
        <td class="px-4 py-3">{{ offer.product.name }}</td>
        <td class="px-4 py-3">
          {% if offer.discount_type == "percentage" %}
            {{ offer.discount_percent }}%
          {% else %}
            ₹{{ offer.discount_percent }}
          {% endif %}
        </td>
        <td class="px-4 py-3">
          {{ offer.start_date|date:"d M Y" }} → {{ offer.end_date|date:"d M Y" }}
        </td>
        <td class="px-4 py-3 {% if offer.status == 'active' %}text-green-500{% elif offer.status == 'inactive' %}text-orange-500{% else %}text-red-500{% endif %} font-semibold">
          {{ offer.status|title }}</td>
        <td class="px-4 py-3 space-x-3">
          <a href="{% url 'admin_product_offer_edit' offer.id %}" class="text-blue-600">Edit</a>
          <button type="button"
          onclick="confirmDelete('{% url 'delete_product_offer' offer.id %}', '{{ offer.name }}')"
          class="text-red-600 hover:text-red-800 font-medium">
            Delete
          </button>

          <form method="post"
                action="{% url 'admin_offer_toggle' 'product' offer.id %}"
                class="inline">
            {% csrf_token %}
            <button class="text-red-600">
              {% if offer.is_active %}Deactivate{% else %}Activate{% endif %}
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="px-6 py-6 text-center text-gray-500">
          No product offers found.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% include "pagination.html" with page_obj=product_offers page_param="product_page" %}


<!-- CATEGORY OFFERS SECTION -->


<h2 class="text-lg font-semibold mt-12 mb-3">Category Offers</h2>

<div class="bg-white border rounded-xl overflow-hidden mb-8">
  <table class="w-full text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-3 text-left">Name</th>
        <th class="px-4 py-3 text-left">Category</th>
        <th class="px-4 py-3 text-left">Discount</th>
        <th class="px-4 py-3 text-left">Validity</th>
        <th class="px-4 py-3 text-left">Status</th>
        <th class="px-4 py-3 text-left">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y">
      {% for offer in category_offers %}
      <tr>
        <td class="px-4 py-3 font-medium">{{ offer.name }}</td>
        <td class="px-4 py-3">{{ offer.category.name }}</td>
        <td class="px-4 py-3">
          {% if offer.discount_type == "percentage" %}
            {{ offer.discount_percent }}%
          {% else %}
            ₹{{ offer.discount_percent }}
          {% endif %}
        </td>
        <td class="px-4 py-3">
          {{ offer.start_date|date:"d M Y" }} → {{ offer.end_date|date:"d M Y" }}
        </td>
        <td class="px-4 py-3 {% if offer.status == 'active' %}text-green-500{% elif offer.status == 'inactive' %}text-orange-500{% else %}text-red-500{% endif %} font-semibold">
          {{ offer.status|title }}</td>
        <td class="px-4 py-3 space-x-3">
          <a href="{% url 'admin_category_offer_edit' offer.id %}" class="text-blue-600">Edit</a>
          <button type="button"
                    onclick="confirmDelete('{% url 'delete_category_offer' offer.id %}', '{{ offer.name }}')"
                    class="text-red-600 hover:text-red-800 font-medium">
              Delete
            </button>
          <form method="post"
                action="{% url 'admin_offer_toggle' 'category' offer.id %}"
                class="inline">
            {% csrf_token %}
            <button class="text-red-600">
              {% if offer.is_active %}Deactivate{% else %}Activate{% endif %}
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="px-6 py-6 text-center text-gray-500">
          No category offers found.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% include "pagination.html" with page_obj=category_offers page_param="category_page" %}
<script>
  function confirmDelete(url, name) {
    confirmAction(`Delete "${name}"?`, "Yes, Delete", () => {
      window.location.href = url;
    });
  }
</script>

{% endblock %}
