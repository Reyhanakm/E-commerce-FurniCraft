{% extends "admin/base_admin.html" %}

{% block content %}
    
    
<h2 class="text-2xl font-semibold text-gray-800 mb-6">
    Return Requests
</h2>

<div class="bg-white shadow rounded-lg overflow-hidden border border-gray-200">
    <table class="min-w-full text-sm text-left text-gray-700">

        <!-- TABLE HEAD -->
        <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
            <tr>
                <th class="px-6 py-3">User</th>
                <th class="px-6 py-3">Order</th>
                <th class="px-6 py-3">Product</th>
                <th class="px-6 py-3">Reason</th>
                <th class="px-6 py-3">Admin Note</th>
                <th class="px-6 py-3 text-center">Status / Action</th>
            </tr>
        </thead>

        <!-- TABLE BODY -->
        <tbody class="divide-y">
            {% for r in returns %}
            <tr class="hover:bg-gray-50">

                <td class="px-6 py-4">
                    {{ r.user.email }}
                </td>

                <td class="px-6 py-4 font-medium">
                    {{ r.item.order.order_id }}
                </td>

                <td class="px-6 py-4">
                    {{ r.item.product.product.name }}
                </td>

                <td class="px-6 py-4 max-w-xs truncate">
                    {{ r.return_reason }}
                </td>

                <td class="px-6 py-4 text-gray-500">
                    {{ r.admin_note|default:"â€”" }}
                </td>

                <!-- ACTIONS -->
                <td class="px-6 py-4 text-center">

                    {% if r.approval_status == "pending" %}
                        <div class="flex flex-col items-center gap-2">

                            <!-- APPROVE -->
                            <form method="post"
                                  action="{% url 'approve_return' r.id %}">
                                {% csrf_token %}
                                <button
                                    class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition">
                                    Approve
                                </button>
                            </form>

                            <!-- REJECT -->
                            <form method="post"
                                  action="{% url 'reject_return' r.id %}"
                                  class="flex gap-1">
                                {% csrf_token %}
                                <input type="text"
                                       name="admin_note"
                                       placeholder="Reason (optional)"
                                       class="border rounded px-2 py-1 text-xs w-40">

                                <button
                                    class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition">
                                    Reject
                                </button>
                            </form>

                        </div>
                    {% else %}
                        <span class="font-semibold
                            {% if r.approval_status == 'refunded' %}text-green-600
                            {% elif r.approval_status == 'rejected' %}text-red-600
                            {% else %}text-gray-600{% endif %}
                        ">
                            {{ r.approval_status|capfirst }}
                        </span>
                    {% endif %}

                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="px-6 py-6 text-center text-gray-500">
                    No return requests found.
                </td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
</div>
{% endblock content %}
