<!-- Coupon UI -->
<div class="mb-4 bg-white shadow rounded-lg p-6">
    <h3 class="font-semibold mb-2">Apply Coupon</h3>

    {% if coupon %}
        <div class="flex justify-between items-center text-green-600">
            <span>Coupon <strong>{{ coupon.code }}</strong> applied</span>

            <button
                hx-post="{% url 'remove_coupon' %}"
                hx-target="#coupon-section"
                hx-swap="innerHTML"
                class="text-red-500 text-sm underline"
            >
                Remove
            </button>
        </div>
    {% else %}
        <form
            hx-post="{% url 'apply_coupon' %}"
            hx-target="#coupon-section"
            hx-swap="innerHTML"
            class="space-y-2"
        >
            {% csrf_token %}
            <input
                type="text"
                name="coupon_code"
                placeholder="Enter coupon code"
                class="border rounded px-3 py-2 w-full"
            >
            <button class="w-full bg-gray-800 text-white py-2 rounded">
                Apply Coupon
            </button>
        </form>
        {% if available_coupons %}
        <div class="mt-4 pt-3 border-t">
            <p class="text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide">Available Offers</p>
            
            <div class="space-y-2 max-h-48 overflow-y-auto pr-1 custom-scrollbar">
                {% for c_data in available_coupons %}
                <div class="border border-dashed border-gray-300 rounded p-2 flex justify-between items-center 
                            {% if not c_data.is_eligible %}bg-gray-50 opacity-60{% else %}bg-white hover:border-gray-400{% endif %} transition">
                    
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-bold text-gray-800">{{ c_data.obj.code }}</span>
                            {% if not c_data.is_eligible %}
                                <span class="text-[10px] bg-gray-200 text-gray-500 px-1 rounded">Locked</span>
                            {% endif %}
                        </div>

                        <p class="text-xs text-green-600 font-medium">
                            {% if c_data.obj.discount_type == 'percentage' %}
                                Save {{ c_data.obj.discount_value|floatformat:0 }}% 
                            {% else %}
                                Flat ₹{{ c_data.obj.discount_value }} OFF
                            {% endif %}

                            {% if c_data.obj.maximum_discount_limit %}
                                (up to ₹{{ c_data.obj.maximum_discount_limit }})
                            {% endif %}
                        </p>
                        
                        {% if not c_data.is_eligible %}
                        <p class="text-[10px] text-red-500">
                            {{ c_data.reason }}
                        </p>
                        {% endif %}
                    </div>

                    {% if c_data.is_eligible %}
                    <button 
                        hx-post="{% url 'apply_coupon' %}" 
                        hx-vals='{"coupon_code": "{{ c_data.obj.code }}"}'
                        hx-target="#coupon-section"
                        class="text-xs bg-gray-100 border border-gray-300 text-gray-700 px-3 py-1 rounded hover:bg-gray-800 hover:text-white transition">
                        Apply
                    </button>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    {% endif %}
</div>

<!-- Price Details -->
<div class="bg-white shadow rounded-lg p-6">
    <h2 class="text-xl font-semibold mb-4">Price Details</h2>

    <p class="flex justify-between">
        <span>Subtotal</span>
        <span>₹{{ subtotal|floatformat:2 }}</span>
    </p>

    {% if offer_discount > 0 %}
    <p class="flex justify-between text-green-600">
        <span>Offer Discount</span>
        <span>- ₹{{ offer_discount }}</span>
    </p>
    {% endif %}

    {% if coupon %}
    <p class="flex justify-between text-green-600">
        <span>Coupon ({{ coupon.code }})</span>
        <span>- ₹{{ coupon_discount|floatformat:2 }}</span>
    </p>
    {% endif %}

    <p class="flex justify-between">
        <span>Shipping</span>
        <span>{% if shipping_cost == 0 %}Free{% else %}₹{{ shipping_cost }}{% endif %}</span>
    </p>

    <hr class="my-3">

    <p class="flex justify-between text-lg font-semibold">
        <span>Total</span>
        <span>₹{{ total|floatformat:2 }}</span>
    </p>
        
</div>
