{% extends "product/navbar_footer.html" %}
{% block content %}
{% load product_filters %}

<div class="max-w-2xl mx-auto mt-10 p-6 bg-white rounded-lg shadow">

    <h1 class="text-2xl font-bold text-green-600 mb-4">
        ðŸŽ‰ Order Placed Successfully!
    </h1>

    <p class="text-gray-700 mb-6">
        Thank you for your purchase! Your order has been placed successfully.
    </p>

    <div class="border rounded-lg p-4 mb-6">
        <h2 class="text-xl font-semibold mb-2">Order Details</h2>

        <p><strong>Order ID:</strong> {{ order.order_id }}</p>
        <p><strong>Date:</strong> {{ order.created_at|date:"d M, Y - h:i A" }}</p>
        <p><strong >Payment Method:</strong> <span class ="text-blue-600 font-bold">{{ order.get_payment_method_display }}</span></p>
        <p><strong>Payment Status:</strong> <span class="{% if order.payment_status == 'paid'%}text-green-600{% elif order.payment_status == 'failed'%}text-red-600{%endif%} font-bold">{{ order.get_payment_status_display }}</span></p>
        <a href="{% url 'user_order_detail' order.order_id %}"
            class="text-sm bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-900 transition">
            View Details
        </a>
    </div>
    <div class="border rounded-lg p-4 mb-6">
        <h2 class="text-xl font-semibold mb-2">Delivery Address</h2>

        <p>{{ order.address.name }}</p>
        <p>{{ order.address.phone_no }}</p>
        <p>{{ order.address.house }}, {{ order.address.street }}</p>
        <p>{{ order.address.district }}, {{ order.address.state }}</p>
        <p>{{ order.address.pincode }}</p>
    </div>

    <div class="border rounded-lg p-4 mb-6">
        <h2 class="text-xl font-semibold mb-2">Items</h2>

        {% for item in order.items.all %}
    <div class="flex justify-between border-b py-2">

        <div class="flex gap-3">
            {% with primary_image=item.product.product.images.all|get_primary_image %}
                            {% if primary_image %}
                                <img src="{{ primary_image.image.url }}" class="w-16 h-16 object-cover border rounded-md">
                            {% else %}
                                <div class="w-16 h-16 bg-gray-100 flex items-center justify-center 
                                            text-gray-400 text-xs border rounded-md">
                                    No Image
                                </div>
                            {% endif %}
                            {% endwith %}
            <div>
                <p class="font-medium">{{ item.product.product.name }}</p>
                <p class="text-sm text-gray-600">Variant: {{ item.product.material_type }}</p>
                <p class="text-sm">Qty: {{ item.quantity }}</p>
                {% if item.offer_percent > 0 %}
                    <p class="text-xs text-green-600">
                        {{ item.offer_percent }}% OFF applied
                    </p>
                {% endif %}

            </div>
        </div>

        <div class="text-right">
            {% if item.offer_percent > 0 %}
                <p class="text-sm text-gray-400 line-through">
                    â‚¹{{ item.unit_price }}
                </p>
                <p class="font-semibold text-[#A89289]">
                    â‚¹{{ item.price }}
                </p>
            {% else %}
                <p>â‚¹{{ item.unit_price }}</p>
            {% endif %}
        </div>

    </div>
    {% endfor %}

    </div>

    <div class="border rounded-lg p-4 mb-6">
        <h2 class="text-xl font-semibold mb-2">Payment Summary</h2>

        <p class="flex justify-between">
                <span>Subtotal:</span>
                <span>â‚¹{{ order.total_price_before_discount }}</span>
            </p>

            {% if order.offer_discount > 0 %}
            <p class="flex justify-between text-green-600">
                <span>Offer Discount:</span>
                <span>- â‚¹{{ order.offer_discount }}</span>
            </p>
            {% endif %}

            {% if order.coupon %}
            <p class="flex justify-between text-green-600">
                <span>Coupon ({{ order.coupon.code }}):</span>
                <span>- â‚¹{{ order.coupon_discount }}</span>
            </p>
            {% endif %}

            <p class="flex justify-between">
                <span>Delivery Charge:</span>
                
                {% if order.delivery_charge > 0 %}
                     <span>â‚¹{{ order.delivery_charge }}</span>
                {% else %}
                    <span class="text-green-600">Free</span>
                {% endif %}
                    
               
            </p>

            <hr class="my-2">

            <p class="flex justify-between font-bold text-lg">
                <span>Total Paid:</span>
                <span>â‚¹{{ order.total_price }}</span>
            </p>
    </div>

    <a href="{% url 'home' %}"
       class="block bg-[#A89289] text-white text-center py-3 rounded-lg hover:bg-[#8f7a73]">
        Continue Shopping
    </a>

</div>
{% endblock %}
