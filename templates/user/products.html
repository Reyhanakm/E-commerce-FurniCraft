{% extends "user/navbar_footer.html" %}

{% block content %}
    
<title>Products</title>
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<script src="https://cdn.tailwindcss.com"></script>

<body class="bg-gray-100">

<div class="max-w-7xl mx-auto p-6">

    <!-- Filters -->
    <form 
        hx-get="{% url 'products' %}" 
        hx-target="#product-container-wrapper"
        hx-push-url="true"
        hx-trigger="change, keyup delay:300ms"
        class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"
    >

        <!-- Search -->
        <div>
            <input 
                type="text"
                name="search"
                value="{{ request.GET.search }}"
                placeholder="Search products..."
                class="w-full px-4 py-2 border rounded-lg focus:ring focus:ring-[#D8C6C0]"
            >
        </div>

        <!-- Category -->
        <div>
            <select name="category" 
                    hx-trigger="change"
                    class="w-full px-4 py-2 border rounded-lg focus:ring focus:ring-[#D8C6C0]">

                <option value="">All Categories</option>

                {% for cat in categories %}
                    <option value="{{ cat.id }}"
                        {% if request.GET.category == cat.id|stringformat:'s' %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Sort -->
        <div>
            <select name="sort"
                    hx-trigger="change"
                    class="w-full px-4 py-2 border rounded-lg focus:ring focus:ring-[#D8C6C0]">

                <option value="">Sort By</option>
                <option value="low_to_high"  {% if request.GET.sort == 'low_to_high' %}selected{% endif %}>Price: Low → High</option>
                <option value="high_to_low"  {% if request.GET.sort == 'high_to_low' %}selected{% endif %}>Price: High → Low</option>
                <option value="a_to_z"       {% if request.GET.sort == 'a_to_z' %}selected{% endif %}>A → Z</option>
                <option value="z_to_a"       {% if request.GET.sort == 'z_to_a' %}selected{% endif %}>Z → A</option>
                <option value="new"          {% if request.GET.sort == 'new' %}selected{% endif %}>New Arrivals</option>
            </select>
        </div>

        <!-- Clear -->
        <div>
            <a href="{% url 'products' %}"
               class="block bg-[#D8C6C0] hover:bg-[#C8B4AD] text-center py-2 rounded-lg text-gray-800">
                Clear
            </a>
        </div>
    </form>


    <!-- HTMX target: grid + pagination -->
    <div id="product-container-wrapper">

        <!-- Product Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

            {% for p in products %}
            <div class="bg-white rounded-xl shadow hover:shadow-xl transition overflow-hidden">

                <!-- Product image -->
                {% with image=p.images.all.0 %}
                    {% if image %}
                        <img src="{{ image.image.url }}" class="h-56 w-full object-cover">
                    {% else %}
                        <img src="https://via.placeholder.com/300" class="h-56 w-full object-cover">
                    {% endif %}
                {% endwith %}

                <div class="p-4 space-y-2">
                    <h3 class="font-semibold text-lg">{{ p.name }}</h3>

                    <!-- Material Types -->
                    <div class="flex flex-wrap gap-2">
                        {% for v in p.variants.all %}
                            <span class="px-3 py-1 text-xs rounded-full bg-gray-100 border text-gray-700">
                                {{ v.material_type }}
                            </span>
                        {% endfor %}
                    </div>

                    <!-- Price -->
                    {% with v=p.variants.all.0 %}
                        {% if v %}
                            <p class="text-[#A89289] font-bold text-lg">₹{{ v.sales_price }}</p>
                        {% endif %}
                    {% endwith %}
                </div>

                <div class="p-4 pt-0">
                    <a href="{% url 'product_details' p.id %}" 
                       class="block text-center bg-[#D8C6C0] hover:bg-[#C8B4AD] text-black py-2 rounded-lg transition">
                        View Details
                    </a>
                </div>
            </div>
            {% empty %}
            <p class="col-span-full text-center text-gray-600">No products found.</p>
            {% endfor %}

        </div>

        {% include 'user/components/pagination.html' %}

    </div>

</div>

</body>
{% endblock content %}
